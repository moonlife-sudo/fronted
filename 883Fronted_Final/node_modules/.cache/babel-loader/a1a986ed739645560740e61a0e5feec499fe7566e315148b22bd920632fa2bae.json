{"ast":null,"code":"import { createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock, createCommentVNode as _createCommentVNode, vModelText as _vModelText, withDirectives as _withDirectives, toDisplayString as _toDisplayString, withModifiers as _withModifiers, renderList as _renderList, Fragment as _Fragment, normalizeClass as _normalizeClass, createTextVNode as _createTextVNode } from \"vue\";\nvar _hoisted_1 = {\n  \"class\": \"leave-page\"\n};\nvar _hoisted_2 = {\n  \"class\": \"page-header\"\n};\nvar _hoisted_3 = {\n  \"class\": \"actions\"\n};\nvar _hoisted_4 = {\n  key: 0,\n  \"class\": \"apply-card\"\n};\nvar _hoisted_5 = {\n  \"class\": \"form-group\"\n};\nvar _hoisted_6 = {\n  \"class\": \"form-row\"\n};\nvar _hoisted_7 = {\n  \"class\": \"form-group\"\n};\nvar _hoisted_8 = {\n  \"class\": \"form-group\"\n};\nvar _hoisted_9 = {\n  \"class\": \"form-actions\"\n};\nvar _hoisted_10 = [\"disabled\"];\nvar _hoisted_11 = {\n  key: 1,\n  \"class\": \"records-section\"\n};\nvar _hoisted_12 = {\n  key: 0,\n  \"class\": \"loading\"\n};\nvar _hoisted_13 = {\n  key: 1,\n  \"class\": \"empty\"\n};\nvar _hoisted_14 = {\n  key: 2,\n  \"class\": \"records-list\"\n};\nvar _hoisted_15 = {\n  \"class\": \"card-header\"\n};\nvar _hoisted_16 = {\n  \"class\": \"time-range\"\n};\nvar _hoisted_17 = {\n  \"class\": \"card-body\"\n};\nvar _hoisted_18 = {\n  \"class\": \"reason\"\n};\nvar _hoisted_19 = {\n  key: 0,\n  \"class\": \"approver\"\n};\nvar _hoisted_20 = {\n  key: 1,\n  \"class\": \"remarks\"\n};\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createElementVNode(\"div\", _hoisted_2, [_cache[6] || (_cache[6] = _createElementVNode(\"h2\", null, \"请假管理\", -1 /* CACHED */)), _createElementVNode(\"div\", _hoisted_3, [!$setup.showForm ? (_openBlock(), _createElementBlock(\"button\", {\n    key: 0,\n    \"class\": \"primary-btn\",\n    onClick: _cache[0] || (_cache[0] = function ($event) {\n      return $setup.showForm = true;\n    })\n  }, \" + 新建申请 \")) : (_openBlock(), _createElementBlock(\"button\", {\n    key: 1,\n    \"class\": \"back-btn\",\n    onClick: _cache[1] || (_cache[1] = function ($event) {\n      return $setup.showForm = false;\n    })\n  }, \" 取消 \"))])]), $setup.showForm ? (_openBlock(), _createElementBlock(\"div\", _hoisted_4, [_cache[10] || (_cache[10] = _createElementVNode(\"h3\", null, \"填写请假单\", -1 /* CACHED */)), _createElementVNode(\"form\", {\n    onSubmit: _cache[5] || (_cache[5] = _withModifiers(function () {\n      return $setup.submitApply && $setup.submitApply.apply($setup, arguments);\n    }, [\"prevent\"]))\n  }, [_createElementVNode(\"div\", _hoisted_5, [_cache[7] || (_cache[7] = _createElementVNode(\"label\", null, \"请假原因\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"textarea\", {\n    \"onUpdate:modelValue\": _cache[2] || (_cache[2] = function ($event) {\n      return $setup.applyForm.reason = $event;\n    }),\n    required: \"\",\n    placeholder: \"请详细描述请假原因...\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.applyForm.reason]])]), _createElementVNode(\"div\", _hoisted_6, [_createElementVNode(\"div\", _hoisted_7, [_cache[8] || (_cache[8] = _createElementVNode(\"label\", null, \"开始时间\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    type: \"datetime-local\",\n    \"onUpdate:modelValue\": _cache[3] || (_cache[3] = function ($event) {\n      return $setup.applyForm.start_time = $event;\n    }),\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.applyForm.start_time]])]), _createElementVNode(\"div\", _hoisted_8, [_cache[9] || (_cache[9] = _createElementVNode(\"label\", null, \"结束时间\", -1 /* CACHED */)), _withDirectives(_createElementVNode(\"input\", {\n    type: \"datetime-local\",\n    \"onUpdate:modelValue\": _cache[4] || (_cache[4] = function ($event) {\n      return $setup.applyForm.end_time = $event;\n    }),\n    required: \"\"\n  }, null, 512 /* NEED_PATCH */), [[_vModelText, $setup.applyForm.end_time]])])]), _createElementVNode(\"div\", _hoisted_9, [_createElementVNode(\"button\", {\n    type: \"submit\",\n    \"class\": \"submit-btn\",\n    disabled: $setup.submitting\n  }, _toDisplayString($setup.submitting ? '提交中...' : '提交申请'), 9 /* TEXT, PROPS */, _hoisted_10)])], 32 /* NEED_HYDRATION */)])) : (_openBlock(), _createElementBlock(\"div\", _hoisted_11, [$setup.loading ? (_openBlock(), _createElementBlock(\"div\", _hoisted_12, \"加载记录中...\")) : $setup.records.length === 0 ? (_openBlock(), _createElementBlock(\"div\", _hoisted_13, \"暂无请假记录\")) : (_openBlock(), _createElementBlock(\"div\", _hoisted_14, [(_openBlock(true), _createElementBlock(_Fragment, null, _renderList($setup.records, function (record) {\n    return _openBlock(), _createElementBlock(\"div\", {\n      key: record.request_id,\n      \"class\": \"record-card\"\n    }, [_createElementVNode(\"div\", _hoisted_15, [_createElementVNode(\"span\", _hoisted_16, _toDisplayString($setup.formatTime(record.start_time)) + \" 至 \" + _toDisplayString($setup.formatTime(record.end_time)), 1 /* TEXT */), _createElementVNode(\"span\", {\n      \"class\": _normalizeClass([\"status-tag\", $setup.getStatusClass(record.status)])\n    }, _toDisplayString($setup.getStatusText(record.status)), 3 /* TEXT, CLASS */)]), _createElementVNode(\"div\", _hoisted_17, [_createElementVNode(\"p\", _hoisted_18, [_cache[11] || (_cache[11] = _createElementVNode(\"strong\", null, \"理由：\", -1 /* CACHED */)), _createTextVNode(_toDisplayString(record.reason), 1 /* TEXT */)]), record.approver_id ? (_openBlock(), _createElementBlock(\"p\", _hoisted_19, \"审批人ID: \" + _toDisplayString(record.approver_id), 1 /* TEXT */)) : _createCommentVNode(\"v-if\", true), record.approval_remarks ? (_openBlock(), _createElementBlock(\"p\", _hoisted_20, [_cache[12] || (_cache[12] = _createElementVNode(\"strong\", null, \"审批意见：\", -1 /* CACHED */)), _createTextVNode(_toDisplayString(record.approval_remarks), 1 /* TEXT */)])) : _createCommentVNode(\"v-if\", true)])]);\n  }), 128 /* KEYED_FRAGMENT */))]))]))]);\n}","map":{"version":3,"names":["_createElementBlock","_hoisted_1","_createElementVNode","_hoisted_2","_hoisted_3","$setup","showForm","onClick","_cache","$event","_hoisted_4","onSubmit","_withModifiers","submitApply","apply","arguments","_hoisted_5","applyForm","reason","required","placeholder","_hoisted_6","_hoisted_7","type","start_time","_hoisted_8","end_time","_hoisted_9","disabled","submitting","_hoisted_10","_hoisted_11","loading","_hoisted_12","records","length","_hoisted_13","_hoisted_14","_Fragment","_renderList","record","key","request_id","_hoisted_15","_hoisted_16","_toDisplayString","formatTime","_normalizeClass","getStatusClass","status","getStatusText","_hoisted_17","_hoisted_18","approver_id","_hoisted_19","approval_remarks","_hoisted_20"],"sources":["/Users/zhouzhou/Desktop/883Fronted_Final/src/views/Student/Teaching/StuLeave.vue"],"sourcesContent":["<template>\n  <div class=\"leave-page\">\n    <div class=\"page-header\">\n      <h2>请假管理</h2>\n      <div class=\"actions\">\n        <button v-if=\"!showForm\" class=\"primary-btn\" @click=\"showForm = true\">\n          + 新建申请\n        </button>\n        <button v-else class=\"back-btn\" @click=\"showForm = false\">\n          取消\n        </button>\n      </div>\n    </div>\n\n    <div v-if=\"showForm\" class=\"apply-card\">\n      <h3>填写请假单</h3>\n      <form @submit.prevent=\"submitApply\">\n        <div class=\"form-group\">\n          <label>请假原因</label>\n          <textarea v-model=\"applyForm.reason\" required placeholder=\"请详细描述请假原因...\"></textarea>\n        </div>\n        <div class=\"form-row\">\n          <div class=\"form-group\">\n            <label>开始时间</label>\n            <input type=\"datetime-local\" v-model=\"applyForm.start_time\" required>\n          </div>\n          <div class=\"form-group\">\n            <label>结束时间</label>\n            <input type=\"datetime-local\" v-model=\"applyForm.end_time\" required>\n          </div>\n        </div>\n        <div class=\"form-actions\">\n          <button type=\"submit\" class=\"submit-btn\" :disabled=\"submitting\">\n            {{ submitting ? '提交中...' : '提交申请' }}\n          </button>\n        </div>\n      </form>\n    </div>\n\n    <div v-else class=\"records-section\">\n      <div v-if=\"loading\" class=\"loading\">加载记录中...</div>\n      <div v-else-if=\"records.length === 0\" class=\"empty\">暂无请假记录</div>\n\n      <div v-else class=\"records-list\">\n        <div v-for=\"record in records\" :key=\"record.request_id\" class=\"record-card\">\n          <div class=\"card-header\">\n            <span class=\"time-range\">\n              {{ formatTime(record.start_time) }} 至 {{ formatTime(record.end_time) }}\n            </span>\n            <span class=\"status-tag\" :class=\"getStatusClass(record.status)\">\n              {{ getStatusText(record.status) }}\n            </span>\n          </div>\n          <div class=\"card-body\">\n            <p class=\"reason\"><strong>理由：</strong>{{ record.reason }}</p>\n            <p class=\"approver\" v-if=\"record.approver_id\">审批人ID: {{ record.approver_id }}</p>\n            <p class=\"remarks\" v-if=\"record.approval_remarks\">\n              <strong>审批意见：</strong>{{ record.approval_remarks }}\n            </p>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { ref, onMounted, reactive, computed } from 'vue'\nimport { useRoute } from 'vue-router'\n\nexport default {\n  name: 'StuLeave',\n  setup() {\n    const route = useRoute()\n    const classId = computed(() => route.query.classId || localStorage.getItem('currentClassId'))\n\n    const showForm = ref(false)\n    const loading = ref(false)\n    const submitting = ref(false)\n    const records = ref([])\n\n    const applyForm = reactive({\n      reason: '',\n      start_time: '',\n      end_time: ''\n    })\n\n    onMounted(() => {\n      fetchRecords()\n    })\n\n    // 查询申请记录 (接口文档 11.2)\n    const fetchRecords = async () => {\n      loading.value = true\n      try {\n        const res = await fetch('http://127.0.0.1:8081/student/leave-requests?page=1&pageSize=20')\n        const result = await res.json()\n        if (result.code === 1) {\n          records.value = result.data.rows || []\n        }\n      } catch (e) {\n        console.error(e)\n      } finally {\n        loading.value = false\n      }\n    }\n\n    // 提交申请 (接口文档 11.1)\n    const submitApply = async () => {\n      if (!classId.value) {\n        alert('缺少班级信息，无法提交')\n        return\n      }\n      submitting.value = true\n      try {\n        const payload = {\n          class_id: Number(classId.value),\n          reason: applyForm.reason,\n          // 转换为 ISO 格式或后端要求的 Timestamp 格式\n          start_time: new Date(applyForm.start_time).toISOString(),\n          end_time: new Date(applyForm.end_time).toISOString()\n        }\n\n        const res = await fetch('http://127.0.0.1:8081/student/leave-requests', {\n          method: 'POST',\n          headers: { 'Content-Type': 'application/json' },\n          body: JSON.stringify(payload)\n        })\n\n        const result = await res.json()\n        if (result.code === 1) {\n          alert('申请已提交')\n          showForm.value = false\n          // 重置表单\n          applyForm.reason = ''\n          applyForm.start_time = ''\n          applyForm.end_time = ''\n          fetchRecords() // 刷新列表\n        } else {\n          alert('提交失败: ' + result.msg)\n        }\n      } catch (e) {\n        alert('提交出错')\n      } finally {\n        submitting.value = false\n      }\n    }\n\n    // 辅助函数\n    const formatTime = (t) => new Date(t).toLocaleString([], { month: 'numeric', day: 'numeric', hour: '2-digit', minute: '2-digit' })\n    \n    const getStatusText = (s) => {\n      const statusMap = { 1: '待审批', 2: '已批准', 3: '已驳回' }\n      return statusMap[s] || '未知'\n    }\n    \n    const getStatusClass = (s) => {\n      const classMap = { 1: 'pending', 2: 'approved', 3: 'rejected' }\n      return classMap[s] || ''\n    }\n\n    return {\n      showForm,\n      loading,\n      submitting,\n      records,\n      applyForm,\n      classId,\n      fetchRecords,\n      submitApply,\n      formatTime,\n      getStatusText,\n      getStatusClass\n    }\n  }\n}\n</script>\n\n<style scoped>\n.leave-page {\n  padding: 24px;\n  max-width: 800px;\n  margin: 0 auto;\n}\n\n.page-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-bottom: 24px;\n}\n\n.primary-btn {\n  background: #2A5CAA;\n  color: white;\n  border: none;\n  padding: 10px 20px;\n  border-radius: 6px;\n  cursor: pointer;\n}\n\n.back-btn {\n  background: white;\n  border: 1px solid #ddd;\n  padding: 10px 20px;\n  border-radius: 6px;\n  cursor: pointer;\n}\n\n/* 表单样式 */\n.apply-card {\n  background: white;\n  padding: 30px;\n  border-radius: 12px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);\n}\n\n.form-group {\n  margin-bottom: 20px;\n}\n\n.form-row {\n  display: flex;\n  gap: 20px;\n}\n\n.form-row .form-group {\n  flex: 1;\n}\n\nlabel {\n  display: block;\n  margin-bottom: 8px;\n  font-weight: 500;\n  color: #333;\n}\n\ntextarea,\ninput {\n  width: 100%;\n  padding: 10px;\n  border: 1px solid #ddd;\n  border-radius: 6px;\n}\n\ntextarea {\n  height: 100px;\n  resize: vertical;\n}\n\n.submit-btn {\n  width: 100%;\n  background: #2A5CAA;\n  color: white;\n  border: none;\n  padding: 12px;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 16px;\n}\n\n.submit-btn:disabled {\n  background: #ccc;\n  cursor: not-allowed;\n}\n\n.form-actions {\n  margin-top: 20px;\n}\n\n/* 列表样式 */\n.records-list {\n  display: flex;\n  flex-direction: column;\n  gap: 15px;\n}\n\n.record-card {\n  background: white;\n  border: 1px solid #eee;\n  border-radius: 8px;\n  overflow: hidden;\n}\n\n.card-header {\n  background: #f8f9fa;\n  padding: 12px 20px;\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  border-bottom: 1px solid #eee;\n}\n\n.card-body {\n  padding: 20px;\n}\n\n.time-range {\n  color: #666;\n  font-size: 14px;\n}\n\n.reason {\n  margin: 0 0 8px 0;\n  color: #333;\n}\n\n.approver {\n  margin: 0 0 8px 0;\n  color: #666;\n  font-size: 14px;\n}\n\n.remarks {\n  color: #d9534f;\n  font-size: 13px;\n  margin-top: 10px;\n  background: #fff5f5;\n  padding: 8px;\n  border-radius: 4px;\n}\n\n.status-tag {\n  padding: 4px 10px;\n  border-radius: 12px;\n  font-size: 12px;\n}\n\n.status-tag.pending {\n  background: #e6f7ff;\n  color: #1890ff;\n}\n\n.status-tag.approved {\n  background: #f6ffed;\n  color: #52c41a;\n}\n\n.status-tag.rejected {\n  background: #fff1f0;\n  color: #ff4d4f;\n}\n\n.loading,\n.empty {\n  text-align: center;\n  padding: 40px;\n  color: #999;\n}\n</style>"],"mappings":";;EACO,SAAM;AAAY;;EAChB,SAAM;AAAa;;EAEjB,SAAM;AAAS;;;EAUD,SAAM;;;EAGlB,SAAM;AAAY;;EAIlB,SAAM;AAAU;;EACd,SAAM;AAAY;;EAIlB,SAAM;AAAY;;EAKpB,SAAM;AAAc;;;;EAQjB,SAAM;;;;EACI,SAAM;;;;EACY,SAAM;;;;EAEhC,SAAM;;;EAET,SAAM;AAAa;;EAChB,SAAM;AAAY;;EAOrB,SAAM;AAAW;;EACjB,SAAM;AAAQ;;;EACd,SAAM;;;;EACN,SAAM;;;uBAvDnBA,mBAAA,CA8DM,OA9DNC,UA8DM,GA7DJC,mBAAA,CAUM,OAVNC,UAUM,G,0BATJD,mBAAA,CAAa,YAAT,MAAI,qBACRA,mBAAA,CAOM,OAPNE,UAOM,G,CANWC,MAAA,CAAAC,QAAQ,I,cAAvBN,mBAAA,CAES;;IAFgB,SAAM,aAAa;IAAEO,OAAK,EAAAC,MAAA,QAAAA,MAAA,gBAAAC,MAAA;MAAA,OAAEJ,MAAA,CAAAC,QAAQ;IAAA;KAAS,UAEtE,M,cACAN,mBAAA,CAES;;IAFM,SAAM,UAAU;IAAEO,OAAK,EAAAC,MAAA,QAAAA,MAAA,gBAAAC,MAAA;MAAA,OAAEJ,MAAA,CAAAC,QAAQ;IAAA;KAAU,MAE1D,G,KAIOD,MAAA,CAAAC,QAAQ,I,cAAnBN,mBAAA,CAuBM,OAvBNU,UAuBM,G,4BAtBJR,mBAAA,CAAc,YAAV,OAAK,qBACTA,mBAAA,CAoBO;IApBAS,QAAM,EAAAH,MAAA,QAAAA,MAAA,MAAAI,cAAA;MAAA,OAAUP,MAAA,CAAAQ,WAAA,IAAAR,MAAA,CAAAQ,WAAA,CAAAC,KAAA,CAAAT,MAAA,EAAAU,SAAA,CAAW;IAAA;MAChCb,mBAAA,CAGM,OAHNc,UAGM,G,0BAFJd,mBAAA,CAAmB,eAAZ,MAAI,qB,gBACXA,mBAAA,CAAoF;;aAAjEG,MAAA,CAAAY,SAAS,CAACC,MAAM,GAAAT,MAAA;IAAA;IAAEU,QAAQ,EAAR,EAAQ;IAACC,WAAW,EAAC;iDAAvCf,MAAA,CAAAY,SAAS,CAACC,MAAM,E,KAErChB,mBAAA,CASM,OATNmB,UASM,GARJnB,mBAAA,CAGM,OAHNoB,UAGM,G,0BAFJpB,mBAAA,CAAmB,eAAZ,MAAI,qB,gBACXA,mBAAA,CAAqE;IAA9DqB,IAAI,EAAC,gBAAgB;;aAAUlB,MAAA,CAAAY,SAAS,CAACO,UAAU,GAAAf,MAAA;IAAA;IAAEU,QAAQ,EAAR;iDAAtBd,MAAA,CAAAY,SAAS,CAACO,UAAU,E,KAE5DtB,mBAAA,CAGM,OAHNuB,UAGM,G,0BAFJvB,mBAAA,CAAmB,eAAZ,MAAI,qB,gBACXA,mBAAA,CAAmE;IAA5DqB,IAAI,EAAC,gBAAgB;;aAAUlB,MAAA,CAAAY,SAAS,CAACS,QAAQ,GAAAjB,MAAA;IAAA;IAAEU,QAAQ,EAAR;iDAApBd,MAAA,CAAAY,SAAS,CAACS,QAAQ,E,OAG5DxB,mBAAA,CAIM,OAJNyB,UAIM,GAHJzB,mBAAA,CAES;IAFDqB,IAAI,EAAC,QAAQ;IAAC,SAAM,YAAY;IAAEK,QAAQ,EAAEvB,MAAA,CAAAwB;sBAC/CxB,MAAA,CAAAwB,UAAU,4CAAAC,WAAA,E,iDAMrB9B,mBAAA,CAuBM,OAvBN+B,WAuBM,GAtBO1B,MAAA,CAAA2B,OAAO,I,cAAlBhC,mBAAA,CAAkD,OAAlDiC,WAAkD,EAAd,UAAQ,KAC5B5B,MAAA,CAAA6B,OAAO,CAACC,MAAM,U,cAA9BnC,mBAAA,CAAgE,OAAhEoC,WAAgE,EAAZ,QAAM,M,cAE1DpC,mBAAA,CAkBM,OAlBNqC,WAkBM,I,kBAjBJrC,mBAAA,CAgBMsC,SAAA,QAAAC,WAAA,CAhBgBlC,MAAA,CAAA6B,OAAO,YAAjBM,MAAM;yBAAlBxC,mBAAA,CAgBM;MAhB0ByC,GAAG,EAAED,MAAM,CAACE,UAAU;MAAE,SAAM;QAC5DxC,mBAAA,CAOM,OAPNyC,WAOM,GANJzC,mBAAA,CAEO,QAFP0C,WAEO,EAAAC,gBAAA,CADFxC,MAAA,CAAAyC,UAAU,CAACN,MAAM,CAAChB,UAAU,KAAI,KAAG,GAAAqB,gBAAA,CAAGxC,MAAA,CAAAyC,UAAU,CAACN,MAAM,CAACd,QAAQ,mBAErExB,mBAAA,CAEO;MAFD,SAAK6C,eAAA,EAAC,YAAY,EAAS1C,MAAA,CAAA2C,cAAc,CAACR,MAAM,CAACS,MAAM;wBACxD5C,MAAA,CAAA6C,aAAa,CAACV,MAAM,CAACS,MAAM,yB,GAGlC/C,mBAAA,CAMM,OANNiD,WAMM,GALJjD,mBAAA,CAA6D,KAA7DkD,WAA6D,G,4BAA3ClD,mBAAA,CAAoB,gBAAZ,KAAG,qB,kCAAYsC,MAAM,CAACtB,MAAM,iB,GAC5BsB,MAAM,CAACa,WAAW,I,cAA5CrD,mBAAA,CAAiF,KAAjFsD,WAAiF,EAAnC,SAAO,GAAAT,gBAAA,CAAGL,MAAM,CAACa,WAAW,oB,mCACjDb,MAAM,CAACe,gBAAgB,I,cAAhDvD,mBAAA,CAEI,KAFJwD,WAEI,G,4BADFtD,mBAAA,CAAsB,gBAAd,OAAK,qB,kCAAYsC,MAAM,CAACe,gBAAgB,iB","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}