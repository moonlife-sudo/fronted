{"ast":null,"code":"import { ref, reactive, onMounted } from 'vue';\nimport { useRoute, useRouter } from 'vue-router';\nexport default /*@__PURE__*/Object.assign({\n  name: 'AttendanceModify'\n}, {\n  __name: 'Modify',\n  setup(__props, {\n    expose: __expose\n  }) {\n    __expose();\n    const route = useRoute();\n    const router = useRouter();\n    const formData = reactive({\n      record_id: '',\n      student_id: '',\n      status: null,\n      remarks: null\n    });\n    const errors = reactive({});\n    const loading = ref(false);\n    onMounted(() => {\n      // 从路由参数中获取数据\n      const recordId = route.query.recordId;\n      const studentId = route.query.studentId;\n      const status = route.query.status;\n      const remarks = route.query.remarks;\n      if (recordId) {\n        formData.record_id = recordId;\n      }\n      if (studentId) {\n        formData.student_id = studentId;\n      }\n      if (status) {\n        formData.status = parseInt(status, 10);\n      }\n      if (remarks) {\n        formData.remarks = remarks;\n      }\n\n      // 如果没有记录ID，提示用户\n      if (!recordId) {\n        alert('缺少记录ID参数，请从考勤详情页面进入');\n        router.back();\n      }\n    });\n    const validateForm = () => {\n      let isValid = true;\n\n      // 验证记录ID\n      if (!formData.record_id || formData.record_id.trim() === '') {\n        errors.record_id = '记录ID不能为空';\n        isValid = false;\n      } else {\n        delete errors.record_id;\n      }\n\n      // 验证状态（如果提供了状态，必须是有效值）\n      if (formData.status !== null && ![1, 2, 3, 4].includes(formData.status)) {\n        errors.status = '请选择有效的考勤状态';\n        isValid = false;\n      } else {\n        delete errors.status;\n      }\n      return isValid;\n    };\n    const handleSubmit = async () => {\n      if (!validateForm()) {\n        return;\n      }\n      loading.value = true;\n      try {\n        // 构建请求体，只包含非null的字段\n        const requestBody = {};\n        if (formData.status !== null) requestBody.status = formData.status;\n        if (formData.remarks !== null && formData.remarks.trim() !== '') {\n          requestBody.remarks = formData.remarks.trim();\n        }\n        const response = await fetch(`http://127.0.0.1:8081/teacher/attendance/records/${formData.record_id}`, {\n          method: 'PUT',\n          headers: {\n            'Content-Type': 'application/json'\n          },\n          body: JSON.stringify(requestBody)\n        });\n        if (!response.ok) {\n          const errorData = await response.json().catch(() => ({}));\n          throw new Error(errorData.msg || `请求失败: ${response.status}`);\n        }\n        const result = await response.json();\n        if (result.code === 1) {\n          alert('考勤修改成功！');\n          router.push('/teaching/attendance/detail');\n        } else {\n          throw new Error(result.msg || '考勤修改失败');\n        }\n      } catch (error) {\n        console.error('修改考勤失败:', error);\n        alert(error instanceof Error ? error.message : '修改考勤失败，请稍后重试');\n      } finally {\n        loading.value = false;\n      }\n    };\n    const handleCancel = () => {\n      router.back();\n    };\n    const __returned__ = {\n      route,\n      router,\n      formData,\n      errors,\n      loading,\n      validateForm,\n      handleSubmit,\n      handleCancel,\n      ref,\n      reactive,\n      onMounted,\n      get useRoute() {\n        return useRoute;\n      },\n      get useRouter() {\n        return useRouter;\n      }\n    };\n    Object.defineProperty(__returned__, '__isScriptSetup', {\n      enumerable: false,\n      value: true\n    });\n    return __returned__;\n  }\n});","map":{"version":3,"names":["ref","reactive","onMounted","useRoute","useRouter","route","router","formData","record_id","student_id","status","remarks","errors","loading","recordId","query","studentId","parseInt","alert","back","validateForm","isValid","trim","includes","handleSubmit","value","requestBody","response","fetch","method","headers","body","JSON","stringify","ok","errorData","json","catch","Error","msg","result","code","push","error","console","message","handleCancel"],"sources":["C:/Users/84712/Downloads/EduSphere-frontend-latest/EduSphere-frontend-latest/883Fronted_Final/src/views/Teacher/Teaching/course/attendance/Modify.vue"],"sourcesContent":["<!-- src/views/teaching/attendance/Modify.vue -->\n<template>\n  <div class=\"attendance-modify\">\n    <div class=\"page-header\">\n      <h1>修改考勤</h1>\n      <p class=\"page-description\">手动修改考勤状态和备注信息</p>\n    </div>\n\n    <section class=\"card form-card\">\n      <form @submit.prevent=\"handleSubmit\" class=\"attendance-form\">\n        <div class=\"form-group\">\n          <label class=\"form-label\">记录ID</label>\n          <div class=\"readonly-field\">{{ formData.record_id || '-' }}</div>\n        </div>\n\n        <div class=\"form-group\">\n          <label class=\"form-label\">学生ID</label>\n          <div class=\"readonly-field\">{{ formData.student_id || '-' }}</div>\n        </div>\n\n        <div class=\"form-group\">\n          <label for=\"status\" class=\"form-label\">考勤状态</label>\n          <select\n            id=\"status\"\n            v-model.number=\"formData.status\"\n            class=\"form-select\"\n            :class=\"{ 'form-select--error': errors.status }\"\n          >\n            <option :value=\"null\">请选择考勤状态（可选）</option>\n            <option :value=\"1\">出勤</option>\n            <option :value=\"2\">缺勤</option>\n            <option :value=\"3\">迟到</option>\n            <option :value=\"4\">请假</option>\n          </select>\n          <div v-if=\"errors.status\" class=\"form-error\">{{ errors.status }}</div>\n          <p class=\"form-hint\">1:出勤, 2:缺勤, 3:迟到, 4:请假</p>\n        </div>\n\n        <div class=\"form-group\">\n          <label for=\"remarks\" class=\"form-label\">备注</label>\n          <textarea\n            id=\"remarks\"\n            v-model=\"formData.remarks\"\n            class=\"form-textarea\"\n            :class=\"{ 'form-textarea--error': errors.remarks }\"\n            placeholder=\"请输入备注信息（可选）\"\n            rows=\"4\"\n          ></textarea>\n          <div v-if=\"errors.remarks\" class=\"form-error\">{{ errors.remarks }}</div>\n        </div>\n\n        <div class=\"form-actions\">\n          <button type=\"button\" class=\"button button--secondary\" @click=\"handleCancel\">取消</button>\n          <button type=\"submit\" class=\"button\" :disabled=\"loading\">\n            <span v-if=\"loading\">保存中...</span>\n            <span v-else>保存修改</span>\n          </button>\n        </div>\n      </form>\n    </section>\n  </div>\n</template>\n\n<script setup>\nimport { ref, reactive, onMounted } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\n\ndefineOptions({\n  name: 'AttendanceModify'\n})\n\nconst route = useRoute()\nconst router = useRouter()\n\nconst formData = reactive({\n  record_id: '',\n  student_id: '',\n  status: null,\n  remarks: null\n})\n\nconst errors = reactive({})\nconst loading = ref(false)\n\nonMounted(() => {\n  // 从路由参数中获取数据\n  const recordId = route.query.recordId\n  const studentId = route.query.studentId\n  const status = route.query.status\n  const remarks = route.query.remarks\n\n  if (recordId) {\n    formData.record_id = recordId\n  }\n  if (studentId) {\n    formData.student_id = studentId\n  }\n  if (status) {\n    formData.status = parseInt(status, 10)\n  }\n  if (remarks) {\n    formData.remarks = remarks\n  }\n\n  // 如果没有记录ID，提示用户\n  if (!recordId) {\n    alert('缺少记录ID参数，请从考勤详情页面进入')\n    router.back()\n  }\n})\n\nconst validateForm = () => {\n  let isValid = true\n\n  // 验证记录ID\n  if (!formData.record_id || formData.record_id.trim() === '') {\n    errors.record_id = '记录ID不能为空'\n    isValid = false\n  } else {\n    delete errors.record_id\n  }\n\n  // 验证状态（如果提供了状态，必须是有效值）\n  if (formData.status !== null && ![1, 2, 3, 4].includes(formData.status)) {\n    errors.status = '请选择有效的考勤状态'\n    isValid = false\n  } else {\n    delete errors.status\n  }\n\n  return isValid\n}\n\nconst handleSubmit = async () => {\n  if (!validateForm()) {\n    return\n  }\n\n  loading.value = true\n\n  try {\n    // 构建请求体，只包含非null的字段\n    const requestBody = {}\n    if (formData.status !== null) requestBody.status = formData.status\n    if (formData.remarks !== null && formData.remarks.trim() !== '') {\n      requestBody.remarks = formData.remarks.trim()\n    }\n\n    const response = await fetch(\n      `http://127.0.0.1:8081/teacher/attendance/records/${formData.record_id}`,\n      {\n        method: 'PUT',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify(requestBody)\n      }\n    )\n\n    if (!response.ok) {\n      const errorData = await response.json().catch(() => ({}))\n      throw new Error(errorData.msg || `请求失败: ${response.status}`)\n    }\n\n    const result = await response.json()\n\n    if (result.code === 1) {\n      alert('考勤修改成功！')\n      router.push('/teaching/attendance/detail')\n    } else {\n      throw new Error(result.msg || '考勤修改失败')\n    }\n  } catch (error) {\n    console.error('修改考勤失败:', error)\n    alert(error instanceof Error ? error.message : '修改考勤失败，请稍后重试')\n  } finally {\n    loading.value = false\n  }\n}\n\nconst handleCancel = () => {\n  router.back()\n}\n</script>\n\n<style scoped>\n.attendance-modify {\n  padding: 24px;\n  max-inline-size: 800px;\n  margin: 0 auto;\n}\n\n.page-header {\n  margin-block-end: 24px;\n}\n\n.page-header h1 {\n  font-size: 24px;\n  font-weight: 600;\n  color: #333;\n  margin: 0 0 8px 0;\n}\n\n.page-description {\n  color: #666;\n  font-size: 14px;\n  margin: 0;\n}\n\n.form-card {\n  margin-block-start: 24px;\n}\n\n.card {\n  background: #fff;\n  border-radius: 8px;\n  border: 1px solid #e8e8e8;\n  box-shadow: 0 6px 24px rgba(0, 0, 0, 0.05);\n}\n\n.button {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  padding: 8px 16px;\n  border-radius: 4px;\n  border: none;\n  background: #2A5CAA;\n  color: #fff;\n  font-size: 14px;\n  cursor: pointer;\n  transition: background 0.2s ease, opacity 0.2s ease;\n}\n\n.button:hover:not(:disabled) {\n  background: #214a88;\n}\n\n.button:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n\n.button--secondary {\n  background: #f5f5f5;\n  color: #333;\n  border: 1px solid #d9d9d9;\n}\n\n.attendance-form {\n  padding: 24px;\n}\n\n.form-group {\n  margin-block-end: 24px;\n}\n\n.form-label {\n  display: block;\n  font-size: 14px;\n  font-weight: 500;\n  color: #333;\n  margin-block-end: 8px;\n}\n\n.readonly-field {\n  padding: 8px 12px;\n  background-color: #f5f5f5;\n  border: 1px solid #d9d9d9;\n  border-radius: 4px;\n  font-size: 14px;\n  color: #666;\n  min-block-size: 38px;\n  display: flex;\n  align-items: center;\n}\n\n.form-select {\n  inline-size: 100%;\n  padding: 8px 12px;\n  border: 1px solid #d9d9d9;\n  border-radius: 4px;\n  font-size: 14px;\n  background-color: #fff;\n  outline: none;\n  transition: all 0.3s;\n}\n\n.form-select:focus {\n  border-color: #2A5CAA;\n  box-shadow: 0 0 0 2px rgba(42, 92, 170, 0.1);\n}\n\n.form-select--error {\n  border-color: #ff4d4f;\n}\n\n.form-select--error:focus {\n  border-color: #ff4d4f;\n  box-shadow: 0 0 0 2px rgba(255, 77, 79, 0.1);\n}\n\n.form-textarea {\n  inline-size: 100%;\n  padding: 8px 12px;\n  border: 1px solid #d9d9d9;\n  border-radius: 4px;\n  font-size: 14px;\n  font-family: inherit;\n  background-color: #fff;\n  outline: none;\n  transition: all 0.3s;\n  resize: vertical;\n}\n\n.form-textarea:focus {\n  border-color: #2A5CAA;\n  box-shadow: 0 0 0 2px rgba(42, 92, 170, 0.1);\n}\n\n.form-textarea--error {\n  border-color: #ff4d4f;\n}\n\n.form-textarea--error:focus {\n  border-color: #ff4d4f;\n  box-shadow: 0 0 0 2px rgba(255, 77, 79, 0.1);\n}\n\n.form-error {\n  color: #ff4d4f;\n  font-size: 12px;\n  margin-block-start: 4px;\n}\n\n.form-hint {\n  color: #999;\n  font-size: 12px;\n  margin-block-start: 8px;\n  margin-block-end: 0;\n}\n\n.form-actions {\n  display: flex;\n  justify-content: flex-end;\n  gap: 12px;\n  margin-block-start: 32px;\n  padding-block-start: 24px;\n  border-block-start: 1px solid #e8e8e8;\n}\n\n@media (max-width: 768px) {\n  .form-actions {\n    flex-direction: column-reverse;\n  }\n\n  .form-actions .button {\n    inline-size: 100%;\n  }\n}\n</style>"],"mappings":"AAgEA,SAASA,GAAG,EAAEC,QAAQ,EAAEC,SAAS,QAAQ,KAAI;AAC7C,SAASC,QAAQ,EAAEC,SAAS,QAAQ,YAAW;;;;;;;;;IAM/C,MAAMC,KAAK,GAAGF,QAAQ,CAAC;IACvB,MAAMG,MAAM,GAAGF,SAAS,CAAC;IAEzB,MAAMG,QAAQ,GAAGN,QAAQ,CAAC;MACxBO,SAAS,EAAE,EAAE;MACbC,UAAU,EAAE,EAAE;MACdC,MAAM,EAAE,IAAI;MACZC,OAAO,EAAE;IACX,CAAC;IAED,MAAMC,MAAM,GAAGX,QAAQ,CAAC,CAAC,CAAC;IAC1B,MAAMY,OAAO,GAAGb,GAAG,CAAC,KAAK;IAEzBE,SAAS,CAAC,MAAM;MACd;MACA,MAAMY,QAAQ,GAAGT,KAAK,CAACU,KAAK,CAACD,QAAO;MACpC,MAAME,SAAS,GAAGX,KAAK,CAACU,KAAK,CAACC,SAAQ;MACtC,MAAMN,MAAM,GAAGL,KAAK,CAACU,KAAK,CAACL,MAAK;MAChC,MAAMC,OAAO,GAAGN,KAAK,CAACU,KAAK,CAACJ,OAAM;MAElC,IAAIG,QAAQ,EAAE;QACZP,QAAQ,CAACC,SAAS,GAAGM,QAAO;MAC9B;MACA,IAAIE,SAAS,EAAE;QACbT,QAAQ,CAACE,UAAU,GAAGO,SAAQ;MAChC;MACA,IAAIN,MAAM,EAAE;QACVH,QAAQ,CAACG,MAAM,GAAGO,QAAQ,CAACP,MAAM,EAAE,EAAE;MACvC;MACA,IAAIC,OAAO,EAAE;QACXJ,QAAQ,CAACI,OAAO,GAAGA,OAAM;MAC3B;;MAEA;MACA,IAAI,CAACG,QAAQ,EAAE;QACbI,KAAK,CAAC,qBAAqB;QAC3BZ,MAAM,CAACa,IAAI,CAAC;MACd;IACF,CAAC;IAED,MAAMC,YAAY,GAAGA,CAAA,KAAM;MACzB,IAAIC,OAAO,GAAG,IAAG;;MAEjB;MACA,IAAI,CAACd,QAAQ,CAACC,SAAS,IAAID,QAAQ,CAACC,SAAS,CAACc,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE;QAC3DV,MAAM,CAACJ,SAAS,GAAG,UAAS;QAC5Ba,OAAO,GAAG,KAAI;MAChB,CAAC,MAAM;QACL,OAAOT,MAAM,CAACJ,SAAQ;MACxB;;MAEA;MACA,IAAID,QAAQ,CAACG,MAAM,KAAK,IAAI,IAAI,CAAC,CAAC,CAAC,EAAE,CAAC,EAAE,CAAC,EAAE,CAAC,CAAC,CAACa,QAAQ,CAAChB,QAAQ,CAACG,MAAM,CAAC,EAAE;QACvEE,MAAM,CAACF,MAAM,GAAG,YAAW;QAC3BW,OAAO,GAAG,KAAI;MAChB,CAAC,MAAM;QACL,OAAOT,MAAM,CAACF,MAAK;MACrB;MAEA,OAAOW,OAAM;IACf;IAEA,MAAMG,YAAY,GAAG,MAAAA,CAAA,KAAY;MAC/B,IAAI,CAACJ,YAAY,CAAC,CAAC,EAAE;QACnB;MACF;MAEAP,OAAO,CAACY,KAAK,GAAG,IAAG;MAEnB,IAAI;QACF;QACA,MAAMC,WAAW,GAAG,CAAC;QACrB,IAAInB,QAAQ,CAACG,MAAM,KAAK,IAAI,EAAEgB,WAAW,CAAChB,MAAM,GAAGH,QAAQ,CAACG,MAAK;QACjE,IAAIH,QAAQ,CAACI,OAAO,KAAK,IAAI,IAAIJ,QAAQ,CAACI,OAAO,CAACW,IAAI,CAAC,CAAC,KAAK,EAAE,EAAE;UAC/DI,WAAW,CAACf,OAAO,GAAGJ,QAAQ,CAACI,OAAO,CAACW,IAAI,CAAC;QAC9C;QAEA,MAAMK,QAAQ,GAAG,MAAMC,KAAK,CAC1B,oDAAoDrB,QAAQ,CAACC,SAAS,EAAE,EACxE;UACEqB,MAAM,EAAE,KAAK;UACbC,OAAO,EAAE;YACP,cAAc,EAAE;UAClB,CAAC;UACDC,IAAI,EAAEC,IAAI,CAACC,SAAS,CAACP,WAAW;QAClC,CACF;QAEA,IAAI,CAACC,QAAQ,CAACO,EAAE,EAAE;UAChB,MAAMC,SAAS,GAAG,MAAMR,QAAQ,CAACS,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC;UACxD,MAAM,IAAIC,KAAK,CAACH,SAAS,CAACI,GAAG,IAAI,SAASZ,QAAQ,CAACjB,MAAM,EAAE;QAC7D;QAEA,MAAM8B,MAAM,GAAG,MAAMb,QAAQ,CAACS,IAAI,CAAC;QAEnC,IAAII,MAAM,CAACC,IAAI,KAAK,CAAC,EAAE;UACrBvB,KAAK,CAAC,SAAS;UACfZ,MAAM,CAACoC,IAAI,CAAC,6BAA6B;QAC3C,CAAC,MAAM;UACL,MAAM,IAAIJ,KAAK,CAACE,MAAM,CAACD,GAAG,IAAI,QAAQ;QACxC;MACF,CAAC,CAAC,OAAOI,KAAK,EAAE;QACdC,OAAO,CAACD,KAAK,CAAC,SAAS,EAAEA,KAAK;QAC9BzB,KAAK,CAACyB,KAAK,YAAYL,KAAK,GAAGK,KAAK,CAACE,OAAO,GAAG,cAAc;MAC/D,CAAC,SAAS;QACRhC,OAAO,CAACY,KAAK,GAAG,KAAI;MACtB;IACF;IAEA,MAAMqB,YAAY,GAAGA,CAAA,KAAM;MACzBxC,MAAM,CAACa,IAAI,CAAC;IACd","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}